<div class="container-dark">
  <header>
    <h1>â˜ï¸ é›²ç«¯æª”æ¡ˆç®¡ç†ç³»çµ± â€” Live Demo</h1>
    <div class="badge">Composite + Visitor + Observer + Command + Strategy Pattern</div>
  </header>

  <!-- ==========================================
       Command Pattern â€” å·¥å…·åˆ— (Toolbar)
       ========================================== -->
  <div class="toolbar">
    <div class="toolbar-group">
      <button
        class="toolbar-btn"
        (click)="undo()"
        [disabled]="!commandHistory.canUndo()"
        title="Undo"
      >
        â†©ï¸
      </button>
      <button
        class="toolbar-btn"
        (click)="redo()"
        [disabled]="!commandHistory.canRedo()"
        title="Redo"
      >
        â†ªï¸
      </button>
    </div>

    <span class="toolbar-divider">|</span>

    <div class="toolbar-group">
      <button
        class="toolbar-btn sort-btn"
        [class.active-sort]="isSortActive('name')"
        (click)="sortBy('name')"
      >
        {{ getSortIcon('name') }}åç¨±
      </button>
      <button
        class="toolbar-btn sort-btn"
        [class.active-sort]="isSortActive('size')"
        (click)="sortBy('size')"
      >
        {{ getSortIcon('size') }}å¤§å°
      </button>
      <button
        class="toolbar-btn sort-btn"
        [class.active-sort]="isSortActive('extension')"
        (click)="sortBy('extension')"
      >
        {{ getSortIcon('extension') }}é¡å‹
      </button>
      <button
        class="toolbar-btn sort-btn"
        [class.active-sort]="isSortActive('tag')"
        (click)="sortBy('tag')"
      >
        {{ getSortIcon('tag') }}æ¨™ç±¤
      </button>
    </div>

    <span class="toolbar-divider">|</span>

    <div class="toolbar-group">
      <span class="toolbar-icon">ğŸ·ï¸</span>
      @for (tag of allTags; track tag) {
        <button
          class="tag-btn"
          [style.background-color]="TAG_COLORS[tag]"
          [disabled]="!selectedNode()"
          (click)="toggleTag(tag)"
        >
          + {{ tag }}
        </button>
      }
    </div>

    <span class="toolbar-divider">|</span>

    <button class="toolbar-btn delete-btn" [disabled]="!selectedNode()" (click)="deleteSelected()">
      ğŸ—‘ï¸ åˆªé™¤
    </button>
  </div>

  <div class="layout">
    <div class="panel tree-panel">
      <h3 class="panel-title">ğŸ“‚ æª”æ¡ˆéšå±¤ (Composite)</h3>
      <ul class="tree-root">
        <ng-container
          *ngTemplateOutlet="nodeTemplate; context: { $implicit: root() }"
        ></ng-container>
      </ul>
    </div>

    <div class="panel action-panel">
      <h3 class="panel-title">ğŸ§‘ è¨ªå•è€…æ“ä½œ (Visitor)</h3>

      <div class="controls">
        <button (click)="calculateTotalSize()" class="btn btn-blue">ğŸ“Š è¨ˆç®—å¤§å°</button>
        <button (click)="exportToXml()" class="btn btn-green">ğŸ“‘ XML åŒ¯å‡º</button>

        <div class="search-group">
          <input
            [ngModel]="searchExt()"
            (ngModelChange)="searchExt.set($event)"
            placeholder="è¼¸å…¥é—œéµå­—..."
            class="input-dark"
          />
          <button (click)="searchFiles()" class="btn btn-orange">æœå°‹ ğŸ”</button>
        </div>
      </div>

      <div class="console-box">
        <div class="console-header">ğŸ“¡ Observer Console â€” æ¨¹ç‹€è¨ªå•å³æ™‚é€²åº¦</div>
        <pre class="console-content">{{ consoleOutput() }}</pre>
      </div>
    </div>
  </div>
</div>

<!-- ç¯€é»éè¿´ Template -->
<ng-template #nodeTemplate let-node>
  <li>
    <div
      class="node-row"
      [class.highlight-visiting]="node.highlightState === 'visiting'"
      [class.highlight-matched]="node.highlightState === 'matched'"
      [class.node-selected]="isSelected(node)"
      (click)="selectNode(node); $event.stopPropagation()"
    >
      <span class="icon">{{ node.getIcon() }}</span>
      <span class="name">{{ node.name }}</span>

      @if (!isDirectory(node)) {
        <span class="separator">â€”</span>
        <span class="type-label">{{ node.getTypeLabel() }}</span>
        <span class="details">{{ node.getDetails() }}</span>
        @if (node.highlightState === 'matched') {
          <span class="match-badge">âœ… MATCH</span>
        }
      } @else {
        <span class="separator">â€”</span>
        <span class="type-label-dir">[ç›®éŒ„]</span>
        <span class="details">({{ node.getSizeKB() }} KB)</span>
      }

      @for (tag of node.getTagsArray(); track tag) {
        <span class="tag-badge" [style.background-color]="getTagColor(tag)">{{ tag }}</span>
      }
    </div>

    @if (isDirectory(node)) {
      <ul class="tree-children">
        @for (child of node.children; track child.name) {
          <ng-container
            *ngTemplateOutlet="nodeTemplate; context: { $implicit: child }"
          ></ng-container>
        }
      </ul>
    }
  </li>
</ng-template>
